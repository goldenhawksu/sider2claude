# Anthropic API ç«¯ç‚¹æµ‹è¯•æŠ¥å‘Š

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

- **æµ‹è¯•æ—¥æœŸ**: 2025-10-17
- **æµ‹è¯•ç›®æ ‡**: ç¬¬ä¸‰æ–¹ Anthropic API (88code.org)
- **æµ‹è¯•å†…å®¹**: Claude Code æ¨¡å‹å…¼å®¹æ€§å’Œ headers é…ç½®
- **æµ‹è¯•ç»“æœ**: âŒ æ‰€æœ‰æµ‹è¯•å¤±è´¥

## ğŸ§ª æµ‹è¯•æ‰§è¡Œ

### æµ‹è¯• 1: Claude Code æ ‡å‡†æ¨¡å‹

æµ‹è¯•äº† Claude Code ä½¿ç”¨çš„ 4 ä¸ªæ ‡å‡†æ¨¡å‹:

| æ¨¡å‹ | HTTP çŠ¶æ€ | è€—æ—¶ | ç»“æœ |
|------|----------|------|------|
| claude-3-5-sonnet-20241022 | 200 | 818ms | âŒ å¤±è´¥ |
| claude-3-opus-20240229 | 200 | 246ms | âŒ å¤±è´¥ |
| claude-3-sonnet-20240229 | 200 | 244ms | âŒ å¤±è´¥ |
| claude-3-haiku-20240307 | 200 | 249ms | âŒ å¤±è´¥ |

**ç»Ÿä¸€é”™è¯¯ä¿¡æ¯**:
```json
{
  "error": {
    "code": 400,
    "type": "Bad Request",
    "message": "æš‚ä¸æ”¯æŒé claude code è¯·æ±‚"
  },
  "type": "error"
}
```

### æµ‹è¯• 2: ä¸åŒ Header é…ç½®

æµ‹è¯•äº† 4 ç§ä¸åŒçš„ headers é…ç½®ç»„åˆ:

#### é…ç½® 1: åŸºç¡€ Headers
```javascript
{
  'Content-Type': 'application/json',
  'Authorization': 'Bearer ${API_KEY}',
  'anthropic-version': '2023-06-01',
  'x-api-key': '${API_KEY}'
}
```
**ç»“æœ**: âŒ å¤±è´¥ (814ms) - "æš‚ä¸æ”¯æŒé claude code è¯·æ±‚"

#### é…ç½® 2: Claude Code User-Agent
```javascript
{
  // åŸºç¡€ headers +
  'User-Agent': 'Claude-Code/1.0.0'
}
```
**ç»“æœ**: âŒ å¤±è´¥ (239ms) - "æš‚ä¸æ”¯æŒé claude code è¯·æ±‚"

#### é…ç½® 3: Claude Code å®Œæ•´ Headers
```javascript
{
  // åŸºç¡€ headers +
  'User-Agent': 'Claude-Code/1.0.0',
  'X-Client-Name': 'claude-code',
  'X-Client-Version': '1.0.0'
}
```
**ç»“æœ**: âŒ å¤±è´¥ (242ms) - "æš‚ä¸æ”¯æŒé claude code è¯·æ±‚"

#### é…ç½® 4: Claude Code Headers + Origin
```javascript
{
  // å®Œæ•´ headers +
  'Origin': 'claude://claude-code',
  'Referer': 'claude://claude-code'
}
```
**ç»“æœ**: âŒ å¤±è´¥ (241ms) - "æš‚ä¸æ”¯æŒé claude code è¯·æ±‚"

## ğŸ” é—®é¢˜åˆ†æ

### 1. ç¬¬ä¸‰æ–¹ API é™åˆ¶æœºåˆ¶

ç¬¬ä¸‰æ–¹ API (88code.org) çš„é™åˆ¶**ä¸æ˜¯åŸºäº HTTP headers**,è€Œæ˜¯åŸºäºæ›´å¤æ‚çš„éªŒè¯æœºåˆ¶:

**å¯èƒ½çš„é™åˆ¶æ–¹å¼**:
- âœ… **IP åœ°å€ç™½åå•**: API Key ç»‘å®šäº†ç‰¹å®šçš„ IP åœ°å€
- âœ… **å®¢æˆ·ç«¯è¯ä¹¦**: éœ€è¦ç‰¹æ®Šçš„ SSL/TLS å®¢æˆ·ç«¯è¯ä¹¦
- âœ… **è¯·æ±‚ç­¾å**: éœ€è¦ç‰¹å®šçš„ç­¾åç®—æ³•
- âœ… **ç”¨æˆ·ä»£ç†æ£€æµ‹**: æ·±åº¦æ£€æµ‹çœŸå®çš„å®¢æˆ·ç«¯ç±»å‹
- âœ… **API Key ç»‘å®š**: Key ä»…åœ¨ç‰¹å®šç¯å¢ƒä¸­æœ‰æ•ˆ

### 2. ä¸ºä»€ä¹ˆæ·»åŠ  headers æ— æ•ˆ

ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡º:

1. **æ‰€æœ‰ header é…ç½®è¿”å›ç›¸åŒé”™è¯¯** - è¯´æ˜æœåŠ¡å™¨ç«¯ä¸ä¾èµ–è¿™äº› headers
2. **HTTP 200 ä½†è¿”å›é”™è¯¯** - API æ­£å¸¸å“åº”,ä½†ä¸šåŠ¡å±‚æ‹’ç»
3. **å“åº”æ—¶é—´ä¸€è‡´** (240-250ms) - è¯´æ˜æ˜¯ç»Ÿä¸€çš„æ‹¦æˆªé€»è¾‘

**ç»“è®º**: ç¬¬ä¸‰æ–¹ API ä½¿ç”¨äº†**æ— æ³•é€šè¿‡ç®€å•ä¿®æ”¹ headers ç»•è¿‡**çš„éªŒè¯æœºåˆ¶ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨å®˜æ–¹ Anthropic API (æ¨è) â­

**æ­¥éª¤**:

1. è·å–å®˜æ–¹ API Key:
   - è®¿é—® https://console.anthropic.com
   - ç™»å½•å¹¶åˆ›å»º API Key (ä»¥ `sk-ant-` å¼€å¤´)

2. æ›´æ–° `.env` æ–‡ä»¶:
   ```bash
   ANTHROPIC_BASE_URL=https://api.anthropic.com
   ANTHROPIC_API_KEY=sk-ant-your-actual-key-here
   ```

3. é‡æ–°æµ‹è¯•:
   ```bash
   cd test
   ANTHROPIC_BASE_URL=https://api.anthropic.com \
   ANTHROPIC_API_KEY=sk-ant-xxx \
   bun run test-anthropic-endpoint.ts
   ```

**ä¼˜åŠ¿**:
- âœ… å®˜æ–¹æ”¯æŒ,ç¨³å®šå¯é 
- âœ… å®Œæ•´åŠŸèƒ½,åŒ…æ‹¬å·¥å…·è°ƒç”¨
- âœ… æ‰€æœ‰ Claude Code æ¨¡å‹éƒ½æ”¯æŒ
- âœ… è¯¦ç»†çš„ API æ–‡æ¡£å’Œæ”¯æŒ

**æˆæœ¬**:
- æŒ‰ token è®¡è´¹
- é…åˆæ··åˆè·¯ç”±,ç®€å•å¯¹è¯ç”¨ Sider AI,å¯èŠ‚çœ 75-90% æˆæœ¬

### æ–¹æ¡ˆ 2: ä»…ä½¿ç”¨ Sider AI (å…è´¹ä½†åŠŸèƒ½å—é™)

**æ­¥éª¤**:

1. æ›´æ–° `.env` æ–‡ä»¶:
   ```bash
   # ä¿ç•™ Sider AI é…ç½®
   SIDER_AUTH_TOKEN=your-sider-token

   # ç§»é™¤æˆ–æ³¨é‡Š Anthropic API é…ç½®
   # ANTHROPIC_BASE_URL=
   # ANTHROPIC_API_KEY=
   ```

2. æ‰€æœ‰è¯·æ±‚å°†è‡ªåŠ¨è·¯ç”±åˆ° Sider AI

**ä¼˜åŠ¿**:
- âœ… å®Œå…¨å…è´¹
- âœ… ç®€å•å¯¹è¯æ•ˆæœè‰¯å¥½

**é™åˆ¶**:
- âŒ å·¥å…·è°ƒç”¨åŠŸèƒ½ä¸å¯ç”¨
- âŒ MCP Server åŠŸèƒ½ä¸å¯ç”¨
- âŒ å­ä»£ç†è°ƒç”¨åŠŸèƒ½ä¸å¯ç”¨
- âŒ éƒ¨åˆ†é«˜çº§åŠŸèƒ½å—é™

### æ–¹æ¡ˆ 3: æ··åˆä½¿ç”¨ (æœ€ä½³æ€§ä»·æ¯”) ğŸŒŸ

**å½“å‰é¡¹ç›®å·²å®ç°æ··åˆè·¯ç”±**,åªéœ€é…ç½®å®˜æ–¹ API å³å¯äº«å—:

**æ™ºèƒ½è·¯ç”±è§„åˆ™**:
1. **ç®€å•å¯¹è¯** â†’ Sider AI (å…è´¹)
2. **å·¥å…·è°ƒç”¨** â†’ Anthropic API (ä»˜è´¹)
3. **MCP Server** â†’ Anthropic API (ä»˜è´¹)
4. **å­ä»£ç†è°ƒç”¨** â†’ Anthropic API (ä»˜è´¹)
5. **è‡ªåŠ¨é™çº§** â†’ å½“ Anthropic å¤±è´¥æ—¶é™çº§åˆ° Sider AI

**æˆæœ¬èŠ‚çœ**:
- ä¸€èˆ¬ä½¿ç”¨åœºæ™¯: èŠ‚çœ **75-85%** æˆæœ¬
- å¤§é‡ç®€å•å¯¹è¯: èŠ‚çœ **85-95%** æˆæœ¬
- å¤§é‡å·¥å…·è°ƒç”¨: èŠ‚çœ **50-70%** æˆæœ¬

## ğŸ“ˆ æµ‹è¯•ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ

### æµ‹è¯•ç¯å¢ƒ (æœ¬åœ°)
- é…ç½®: `.env` æ–‡ä»¶
- ä½¿ç”¨: `bun run dev`
- ç«¯å£: `http://localhost:4141`

### ç”Ÿäº§ç¯å¢ƒ (Deno Deploy)
- é…ç½®: Deno Deploy æ§åˆ¶å° â†’ Settings â†’ Environment Variables
- URL: `https://deno-sider2claude.deno.dev`
- æ›´æ–°æ­¥éª¤:
  1. ç™»å½• Deno Deploy
  2. è¿›å…¥é¡¹ç›®è®¾ç½®
  3. æ›´æ–°ç¯å¢ƒå˜é‡:
     - `ANTHROPIC_BASE_URL=https://api.anthropic.com`
     - `ANTHROPIC_API_KEY=sk-ant-xxx`
  4. ä¿å­˜åè‡ªåŠ¨é‡æ–°éƒ¨ç½²

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ (æ¨è)

1. **è·å–å®˜æ–¹ API Key**:
   ```bash
   # è®¿é—® https://console.anthropic.com
   # åˆ›å»ºæ–°çš„ API Key
   ```

2. **æ›´æ–°æœ¬åœ°é…ç½®** (`.env`):
   ```bash
   ANTHROPIC_BASE_URL=https://api.anthropic.com
   ANTHROPIC_API_KEY=sk-ant-your-key-here
   ```

3. **é‡æ–°æµ‹è¯•**:
   ```bash
   cd test
   bun run test-anthropic-endpoint.ts
   ```

4. **æ›´æ–° Deno Deploy é…ç½®**:
   - ç™»å½• Deno Deploy æ§åˆ¶å°
   - æ›´æ–°ç¯å¢ƒå˜é‡
   - ç­‰å¾…è‡ªåŠ¨é‡æ–°éƒ¨ç½²

5. **éªŒè¯éƒ¨ç½²**:
   ```bash
   cd test
   DEPLOY_URL=https://deno-sider2claude.deno.dev \
   bun run test-deployment-universal.ts
   ```

### é¢„æœŸç»“æœ

**æœ¬åœ°æµ‹è¯•**:
```
âœ… claude-3-5-sonnet-20241022  æˆåŠŸ  (500ms)
âœ… claude-3-opus-20240229      æˆåŠŸ  (450ms)
âœ… claude-3-sonnet-20240229    æˆåŠŸ  (480ms)
âœ… claude-3-haiku-20240307     æˆåŠŸ  (300ms)

æˆåŠŸç‡: 100%
```

**éƒ¨ç½²æµ‹è¯•**:
```
âœ… Health Check        é€šè¿‡
âœ… API Info            é€šè¿‡
âœ… Backend Status      é€šè¿‡
âœ… Simple Chat         é€šè¿‡ (Sider AI)
âœ… Tool Call           é€šè¿‡ (Anthropic API) â† ä¿®å¤!
âœ… Authentication      é€šè¿‡
âœ… Token Count         é€šè¿‡

æˆåŠŸç‡: 100% (7/7)
```

## ğŸ“ æ€»ç»“

**æ ¸å¿ƒå‘ç°**:
- âŒ ç¬¬ä¸‰æ–¹ API (88code.org) æ— æ³•é€šè¿‡ä¿®æ”¹ headers ç»•è¿‡é™åˆ¶
- âœ… å·²æµ‹è¯•æ‰€æœ‰å¯èƒ½çš„ header é…ç½®ç»„åˆ
- âœ… é—®é¢˜æ ¹æºæ˜¯ IP ç»‘å®šæˆ–å®¢æˆ·ç«¯è®¤è¯æœºåˆ¶
- âœ… å®˜æ–¹ API æ˜¯å”¯ä¸€å¯é çš„è§£å†³æ–¹æ¡ˆ

**æ¨èæ–¹æ¡ˆ**:
- ğŸŒŸ **æ··åˆè·¯ç”± + å®˜æ–¹ API** - æœ€ä½³æ€§ä»·æ¯”
- ç®€å•å¯¹è¯èµ° Sider AI (å…è´¹)
- å·¥å…·è°ƒç”¨èµ°å®˜æ–¹ API (ä»˜è´¹ä½†åŠŸèƒ½å®Œæ•´)
- è‡ªåŠ¨é™çº§ä¿è¯é«˜å¯ç”¨æ€§

**æˆæœ¬å¯¹æ¯”**:
- çº¯å®˜æ–¹ API: $$$$$ (100%)
- æ··åˆè·¯ç”±: $ (15-25% æˆæœ¬)
- çº¯ Sider AI: $ (0% ä½†åŠŸèƒ½å—é™)

**æœ€ç»ˆè¯„ä»·**: å»ºè®®æ›´æ–°åˆ°å®˜æ–¹ API,é…åˆæ··åˆè·¯ç”±å¯ä»¥åœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶,å¤§å¹…é™ä½ä½¿ç”¨æˆæœ¬! ğŸ¯
