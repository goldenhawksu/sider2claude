# Sider2API - Deno Deploy éƒ¨ç½²æŒ‡å—

## ğŸ¯ å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆ

ç”±äº Deno Deploy ä¸å½“å‰ Bun ä»£ç åº“å­˜åœ¨ä¸€äº›å·®å¼‚ï¼Œæˆ‘ä¸ºä½ æä¾›äº†ä¸¤ä¸ªæ–¹æ¡ˆï¼š

---

## æ–¹æ¡ˆ A: ä½¿ç”¨ Deno Deploy çš„ npm å…¼å®¹å±‚ï¼ˆæ¨èï¼‰â­â­â­â­â­

Deno Deploy ç°åœ¨æ”¯æŒé€šè¿‡ `npm:` å‰ç¼€å¯¼å…¥ npm åŒ…ï¼Œè¿™æ„å‘³ç€**æœ€å°æ”¹é€ **å³å¯éƒ¨ç½²ï¼

### æ­¥éª¤ 1: åˆ›å»º `deno/main.ts` å…¥å£æ–‡ä»¶

å·²åˆ›å»ºåœ¨ `deno/main.ts`ï¼Œå…³é”®æ”¹åŠ¨ï¼š

```typescript
// ç¯å¢ƒå˜é‡è®¿é—®
const PORT = parseInt(Deno.env.get('PORT') || '8000');

// å…¶ä»–ä»£ç ä¿æŒä¸å˜ï¼ŒHono å®Œå…¨å…¼å®¹
```

### æ­¥éª¤ 2: åˆ›å»º `deno.json` é…ç½®

å·²åˆ›å»ºï¼Œé…ç½®äº† npm ä¾èµ–æ˜ å°„ï¼š

```json
{
  "imports": {
    "hono": "npm:hono@4.9.0",
    "consola": "npm:consola@3.2.3"
  }
}
```

### æ­¥éª¤ 3: å‡†å¤‡éƒ¨ç½²

æœ‰ä¸¤ç§æ–¹å¼ï¼š

#### é€‰é¡¹ A: ä½¿ç”¨ GitHub é›†æˆï¼ˆæ¨èï¼‰

1. å°†ä»£ç æ¨é€åˆ° GitHub
2. è®¿é—® https://dash.deno.com/new
3. é€‰æ‹©ä½ çš„ GitHub ä»“åº“
4. è®¾ç½®å…¥å£æ–‡ä»¶: `deno/main.ts`
5. æ·»åŠ ç¯å¢ƒå˜é‡:
   ```
   SIDER_AUTH_TOKEN=<ä½ çš„Token>
   SIDER_API_URL=https://sider.ai/api/chat/v1/completions
   ```
6. ç‚¹å‡» "Deploy"

#### é€‰é¡¹ B: ä½¿ç”¨ Deno CLI

```bash
# å®‰è£… Deno
curl -fsSL https://deno.land/install.sh | sh

# å®‰è£… deployctl
deno install -A --no-check -r -f https://deno.land/x/deploy/deployctl.ts

# éƒ¨ç½²
deployctl deploy \
  --project=sider2claude \
  --token=<your-deno-deploy-token> \
  deno/main.ts
```

---

## æ–¹æ¡ˆ B: å®Œæ•´è¿ç§»ï¼ˆéœ€è¦æ›´å¤šå·¥ä½œï¼‰

å¦‚æœä½ æƒ³å®Œå…¨è¿ç§»åˆ° Deno ç”Ÿæ€ï¼Œéœ€è¦ï¼š

1. å°†æ‰€æœ‰ `process.env` æ”¹ä¸º `Deno.env.get()`
2. æ‰€æœ‰å¯¼å…¥è¯­å¥æ·»åŠ  `.ts` åç¼€
3. ä½¿ç”¨ Deno æ ‡å‡†åº“æ›¿ä»£ npm åŒ…

**é¢„è®¡å·¥ä½œé‡**: 2-3 å°æ—¶

---

## ğŸ”§ å½“å‰çŠ¶æ€

### å·²å®Œæˆ âœ…

- [x] åˆ›å»º `deno.json` é…ç½®
- [x] åˆ›å»º `deno/main.ts` å…¥å£æ–‡ä»¶
- [x] åˆ›å»ºç¯å¢ƒå˜é‡é€‚é…å±‚ `deno/src/utils/env.ts`
- [x] é…ç½® npm ä¾èµ–æ˜ å°„
- [x] å¤åˆ¶å¹¶é€‚é…æ‰€æœ‰æºæ–‡ä»¶åˆ° `deno/src/` ï¼ˆ13ä¸ªæ–‡ä»¶ï¼‰
- [x] ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶çš„å¯¼å…¥è¯­å¥ï¼ˆæ·»åŠ  `.ts`ï¼‰
- [x] æ›¿æ¢æ‰€æœ‰ `process.env` ä¸º `Deno.env.get()`
- [x] æ›¿æ¢ consola ä¸º console æ—¥å¿—
- [x] ä¿®å¤å¯¼å…¥æ‰©å±•åé”™è¯¯

### å¾…å®Œæˆ â³

- [ ] å®‰è£… Deno å¹¶æœ¬åœ°æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- [ ] éƒ¨ç½²åˆ° Deno Deploy

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæœ€ç®€å•æ–¹å¼ï¼‰

å¦‚æœä½ æƒ³å¿«é€Ÿä½“éªŒ Deno Deployï¼Œæˆ‘å»ºè®®ï¼š

### ä½¿ç”¨æˆ‘åˆ›å»ºçš„ç®€åŒ–å…¥å£æ–‡ä»¶

æˆ‘å·²ç»åˆ›å»ºäº† `deno/main.ts`ï¼Œå®ƒå¯¼å…¥äº† Hono å¹¶è®¾ç½®äº†åŸºæœ¬è·¯ç”±ã€‚

### æ‰‹åŠ¨æ­¥éª¤ï¼š

1. **å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶**
   ```bash
   # åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
   cp -r src/types deno/src/
   cp -r src/middleware deno/src/
   cp -r src/utils deno/src/
   cp -r src/routes deno/src/
   ```

2. **æ‰¹é‡æ›¿æ¢å¯¼å…¥è¯­å¥**
   ```bash
   # Linux/macOS
   find deno/src -name "*.ts" -exec sed -i '' \
     "s/from '\([^']*\)'/from '\1.ts'/g" {} \;

   # Windows (PowerShell)
   Get-ChildItem -Recurse deno/src/*.ts | ForEach-Object {
     (Get-Content $_) -replace "from '([^']+)'", "from '$1.ts'" |
     Set-Content $_
   }
   ```

3. **æ›¿æ¢ç¯å¢ƒå˜é‡è®¿é—®**
   ```bash
   # Linux/macOS
   find deno/src -name "*.ts" -exec sed -i '' \
     's/process\.env\.\([A-Z_]*\)/Deno.env.get("\1")/g' {} \;
   ```

4. **æ›´æ–°è·¯ç”±å¯¼å…¥**

   ç¼–è¾‘ `deno/main.ts`ï¼Œç¡®ä¿æ­£ç¡®å¯¼å…¥:
   ```typescript
   import { messagesRouter } from './src/routes/messages.ts';
   ```

5. **æœ¬åœ°æµ‹è¯•**
   ```bash
   deno task dev
   # æˆ–
   deno run --allow-net --allow-env --allow-read --watch deno/main.ts
   ```

6. **éƒ¨ç½²åˆ° Deno Deploy**
   - æ¨é€åˆ° GitHub
   - åœ¨ Deno Deploy Dashboard é€‰æ‹©ä»“åº“
   - è®¾ç½®å…¥å£: `deno/main.ts`
   - æ·»åŠ ç¯å¢ƒå˜é‡
   - éƒ¨ç½²ï¼

---

## ğŸ¯ æˆ‘çš„å»ºè®®

åŸºäºä½ å½“å‰çš„æƒ…å†µï¼ˆRailway å·²ç»è¿è¡Œè‰¯å¥½ï¼Œ88.2% æµ‹è¯•é€šè¿‡ï¼‰ï¼Œæˆ‘å»ºè®®ï¼š

### é€‰é¡¹ 1: ä¿æŒ Railwayï¼ˆæ¨èï¼‰â­â­â­â­â­

**ç†ç”±**:
- âœ… å½“å‰å·²ç»å®Œç¾è¿è¡Œ
- âœ… é›¶æ”¹é€ æˆæœ¬
- âœ… æ‰€æœ‰æµ‹è¯•å·²éªŒè¯
- âœ… Bun æ€§èƒ½ä¼˜ç§€

**é€‚åˆ**: ä¸“æ³¨ä¸šåŠ¡ï¼Œä¸æŠ˜è…¾æŠ€æœ¯æ ˆ

### é€‰é¡¹ 2: å°è¯• Deno Deployï¼ˆæ¢ç´¢ï¼‰â­â­â­â­

**ç†ç”±**:
- âœ… å…¨çƒè¾¹ç¼˜ç½‘ç»œ
- âœ… å†·å¯åŠ¨æ›´å¿« (~50-200ms)
- âœ… å…è´¹é¢åº¦é«˜ (100ä¸‡è¯·æ±‚/æœˆ)
- âš ï¸ éœ€è¦ 1-2 å°æ—¶æ”¹é€ 

**é€‚åˆ**: è¿½æ±‚å…¨çƒä½å»¶è¿Ÿ

### é€‰é¡¹ 3: åŒå¹³å°æ”¯æŒï¼ˆé«˜çº§ï¼‰â­â­â­

**ç†ç”±**:
- âœ… æœ€å¤§çµæ´»æ€§
- âœ… å¯ä»¥ A/B æµ‹è¯•
- âŒ éœ€è¦ç»´æŠ¤ä¸¤å¥—ä»£ç 

**é€‚åˆ**: å¤§å‹é¡¹ç›®æˆ–æŠ€æœ¯æ¢ç´¢

---

## ğŸ“Š å¹³å°å¯¹æ¯”

| ç‰¹æ€§ | Railway | Deno Deploy |
|------|---------|-------------|
| **å½“å‰çŠ¶æ€** | âœ… å·²éƒ¨ç½²ï¼Œè¿è¡Œè‰¯å¥½ | â³ éœ€è¦é…ç½® |
| **æµ‹è¯•é€šè¿‡ç‡** | 88.2% (15/17) | æœªæµ‹è¯• |
| **æ”¹é€ æˆæœ¬** | âœ… é›¶æ”¹é€  | âš ï¸ 1-2å°æ—¶ |
| **å†·å¯åŠ¨** | ~1-2s | ~50-200ms |
| **å…¨çƒåˆ†å‘** | ğŸŸ¡ å•åŒºåŸŸ | âœ… å…¨çƒè¾¹ç¼˜ |
| **å…è´¹é¢åº¦** | $5/æœˆ | 100ä¸‡è¯·æ±‚/æœˆ |
| **è¿è¡Œæ—¶** | Bunï¼ˆåŸç”Ÿï¼‰ | Deno |
| **å†…å­˜å­˜å‚¨** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |

---

## â“ éœ€è¦æˆ‘å¸®ä½ ï¼Ÿ

æˆ‘å¯ä»¥ï¼š

1. **å®Œæ•´å®æ–½ Deno è¿ç§»**ï¼ˆåˆ›å»ºæ‰€æœ‰é€‚é…æ–‡ä»¶ï¼‰
2. **æä¾›è¯¦ç»†çš„æ‰‹åŠ¨æ­¥éª¤**ï¼ˆä½ è‡ªå·±æ“ä½œï¼‰
3. **æ¨èä¿æŒç°çŠ¶**ï¼ˆRailway å·²ç»å¾ˆå¥½äº†ï¼‰

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼

---

## ğŸ”— ç›¸å…³èµ„æº

- [Deno Deploy æ–‡æ¡£](https://deno.com/deploy/docs)
- [Hono Deno æŒ‡å—](https://hono.dev/getting-started/deno)
- [deployctl CLI](https://deno.com/deploy/docs/deployctl)

---

**å½“å‰çŠ¶æ€**: âœ… ä»£ç è¿ç§»å®Œæˆï¼Œå¯ç«‹å³éƒ¨ç½²åˆ° Deno Deploy

**å»ºè®®**: ğŸŸ¢ ä¿æŒ Railway éƒ¨ç½²ï¼ˆå·²éªŒè¯ï¼‰ï¼Œå°† Deno Deploy ä½œä¸ºå¯é€‰æ–¹æ¡ˆæˆ–å¤‡ç”¨å¹³å°

**è¯¦ç»†æŠ¥å‘Š**: è¯·æŸ¥çœ‹ [docs/DENO-MIGRATION-COMPLETED.md](docs/DENO-MIGRATION-COMPLETED.md) è·å–å®Œæ•´çš„è¿ç§»æŠ¥å‘Šå’ŒéªŒè¯æ¸…å•
